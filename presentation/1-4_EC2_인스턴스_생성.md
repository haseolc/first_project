# 1-4. EC2 인스턴스 생성

이 단계에서는 **실제 서버(EC2)를 생성한다.**

앞 단계에서 준비한 네트워크와 Security Group을 이 인스턴스에 연결한다.

# 1️⃣ 기본 설정

EC2는 다음 설정으로 생성된다.

- AMI: Amazon Linux 2023
- Instance Type: `t3.small`
- Key Pair: `infra-dev-key`
- Public IP: 자동 할당
- Subnet: Default VPC의 Public Subnet (AZ-a)

이 설정의 의미는 다음과 같다.

- 운영체제는 최신 Amazon Linux 기반이다.
- 개발/테스트 용도로 적절한 사양이다.
- SSH 접속이 가능한 상태로 생성된다.
- 외부에서 접근 가능하다.

# 2️⃣ Security Group 연결

EC2에는 다음 두 개의 Security Group이 연결된다.

- ssh_sg
- web_sg

이로 인해:

- SSH 접속이 가능하다.
- HTTP/HTTPS 접근이 가능하다.
- Kubernetes 및 NodePort 통신이 가능하다.

# 3️⃣ 스토리지 설정 (Root Volume)

EC2의 기본 디스크는 다음과 같이 설정된다.

- 크기: 20GB
- 타입: gp3
- IOPS: 3000
- Throughput: 125
- 인스턴스 종료 시 자동 삭제

의미는 다음과 같다.

- 일반적인 테스트/실습 환경에 충분한 성능이다.
- 인스턴스를 삭제하면 디스크도 함께 삭제된다.
- 불필요한 비용이 남지 않는다.

# 4️⃣ user_data 실행 (초기 설정 자동화)

EC2가 처음 생성될 때 다음 작업이 자동으로 실행된다.

- wget 설치
- MySQL Repository 등록
- 시스템 업데이트
- MySQL Client 설치

이 설정의 목적은 다음과 같다.

- 서버가 생성되자마자 DB 연결 테스트가 가능하도록 준비한다.
- Ansible 이전 단계에서 최소한의 환경을 갖춘다.

# 5️⃣ 태그 설정

EC2에는 다음 태그가 붙는다.

- Name: `ec2-7th-room`
- Environment: `dev`

태그의 목적은 다음과 같다.

- AWS 콘솔에서 식별이 쉽다.
- 환경(dev/prod) 구분이 가능하다.

# 6️⃣ 출력값 (Output)

Terraform은 EC2 생성 후 다음 값을 출력한다.

- `room7_public_ip`

이 값은 이후 단계에서 매우 중요하다.

- GitHub Actions가 이 IP로 SSH 접속한다.
- Ansible이 이 IP를 대상으로 배포를 수행한다.

이 단계가 완료되면 EC2는 “접속 가능한 빈 서버 상태”가 된다.
